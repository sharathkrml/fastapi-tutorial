version: "3.8"

name: skyhigh-backend

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    # Container name is optional - deployment platforms may assign their own
    # Uncomment for local development if needed:
    # container_name: fastapi-tutorial
    # Port mapping - comment out for deployment platforms (Coolify, etc.) that handle ports automatically
    # For local development, uncomment the line below:
    # ports:
    #   - "8000:8000"
    # Expose port 8000 to other containers (doesn't bind to host)
    expose:
      - "8000"
    depends_on:
      - timescaledb
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - POSTGRES_HOST=timescaledb
      - POSTGRES_PORT=5432
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

  timescaledb:
    image: timescale/timescaledb-ha:pg16
    container_name: timescaledb
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    # Port mapping removed for production - database is accessible via Docker network
    # For local development, add to docker-compose.local.yml if needed
    # ports:
    #   - "5432:5432"
    volumes:
      - timescaledb_data:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  timescaledb_data:
