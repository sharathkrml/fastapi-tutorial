version: "3.8"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    # Container name is optional - deployment platforms may assign their own
    # Uncomment for local development if needed:
    # container_name: fastapi-tutorial
    # Port mapping - comment out for deployment platforms (Coolify, etc.) that handle ports automatically
    # For local development, uncomment the line below:
    # ports:
    #   - "8000:8000"
    # Expose port 8000 to other containers (doesn't bind to host)
    expose:
      - "8000"
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
    # Use volume mount for LanceDB data (recommended for production)
    # This ensures the _versions directories are accessible and avoids copy issues
    volumes:
      - ./app/utils/lancedb_data:/app/utils/lancedb_data:ro
